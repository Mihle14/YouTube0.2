<%= turbo_frame_tag dom_id(comment) do %>
  <div class="flex gap-3 py-3">
    <div class="flex-1">
      <div class="flex items-center gap-2">
        <%= link_to comment.user.email, channel_path(comment.user.channel),
            class: "font-semibold text-sm text-white hover:underline" %>
        <span class="text-xs text-gray-400">
          <%= time_ago_in_words(comment.created_at) %> ago
        </span>
      </div>

      <p class="text-sm text-gray-300 mt-1 whitespace-pre-line">
        <%= comment.body %>
      </p>

      <div class="mt-2 flex gap-4 text-xs text-gray-400">
        <% if local_assigns[:current_user].present? %>
          <a href="#" data-reply-toggle="<%= comment.id %>" class="hover:text-white">Reply</a>
        <% else %>
          <%= link_to "Sign in to reply", new_user_session_path, class: "text-gray-400 hover:text-white" %>
        <% end %>

        <% if local_assigns[:current_user] == comment.user %>
          <%= button_to "Delete",
              post_comment_path(comment.post, comment),
              method: :delete,
              data: { turbo_frame: dom_id(comment), confirm: "Delete this comment?" },
              class: "text-red-400 hover:text-red-300" %>
        <% end %>
      </div>
      <div id="replies-<%= comment.id %>" class="mt-3 ml-10 space-y-3">
        <% comment.replies.order(created_at: :asc).each do |reply| %>
          <%= render partial: "comments/comment", locals: { comment: reply, current_user: local_assigns[:current_user] } %>
        <% end %>
      </div>
      <% if local_assigns[:current_user].present? %>
        <div id="reply-form-<%= comment.id %>" class="mt-3 ml-10 hidden">
          <%= form_with model: [comment.post, Comment.new],
                local: false,
                data: { turbo_frame: dom_id(comment) },
                class: "flex gap-2 items-center" do |f| %>
            <%= f.hidden_field :parent_id, value: comment.id %>
            <%= f.text_field :body,
                  placeholder: "Add a replyâ€¦",
                  class: "flex-1 p-2 rounded-lg bg-gray-800 text-white text-sm border border-gray-700" %>
            <%= f.submit "Reply",
                  class: "px-3 py-1 rounded-lg bg-gray-700 text-white hover:bg-gray-600 text-sm" %>
          <% end %>
        </div>
      <% end %>

      <% if comment.parent_id.nil? %>
        <div class="border-b border-gray-800 mt-3"></div>
      <% end %>

    </div>
  </div>
<% end %>
